{% extends 'admin/base_site.html' %}
{% load static i18n admin_urls %}
{% block extrahead %}{{ block.super }}
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    <script>tinymce.init({
        selector: 'textarea',
        visual: false,
    });
    </script>
    <script src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/dmp.css' %}" type="text/css"/>

{% endblock %}

{% block usertools %}
<div id="user-tools">
    {% block welcome-msg %}
        {% trans 'Welcome,' %}
        <strong>{% firstof user.get_short_name user.get_username %}</strong>.
    {% endblock %}
    {% block userlinks %}
        {% if site_url %}
            <a href="{{ site_url }}">{% trans 'View site' %}</a> /
        {% endif %}
        {% if user.is_active and user.is_staff %}
            {% url 'django-admindocs-docroot' as docsroot %}
            {% if docsroot %}
                <a href="{{ docsroot }}">{% trans 'Documentation' %}</a> /
            {% endif %}
        {% endif %}
        {% if user.has_usable_password %}
        <a href="{% url 'admin:password_change' %}">{% trans 'Change password' %}</a> /
        {% endif %}
        <a href="{% url 'admin:logout' %}">{% trans 'Log out' %}</a>
    {% endblock %}
</div>
{% endblock %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
        ﻿<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
        ﻿&rsaquo;
        <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
        ﻿&rsaquo;
        <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
        ﻿&rsaquo;
        ﻿<a href="/admin/dmp/project/{{ project.id }}/change">{{ project.title|capfirst }}</a>
        ﻿&rsaquo;
        Draft DMP

    </div>

{% endblock %}

{% block content %}
    {% if google_user %}
        <div style="padding-bottom: 10px">
            <div class="google_user_dropdown">
                <a class="google_account_info dropbtn" onclick="showDetails()" onmouseover="showDetails()"
                   title="Google account currently attached to logged in user">
                    {{ google_user.initial }}
                </a>
                <div id="myDropdown" class="google_user_dropdown-content">
                    <table style="width:100%">
                        <tr>
                            <th style="width: 35%; background-color: rgba(0, 151, 200, 0.03)" colspan="2"> Google Account Information</th>
                        </tr>
                        <tr>
                            <td rowspan="2">
                                <img style="height: 65px; width: 65px; border-radius: 10px" src="{{ google_user.picture }}">
                            </td>
                            <td style="border-bottom: none; padding-bottom: 5px"><h2>{{ google_user.name }}</h2></td>
                        </tr>
                        <tr>
                            <td style="padding-top: 5px">{{ google_user.email }}</td>
                        </tr>
                        <tr>
                            <td colspan="2" style="background-color: rgba(0, 151, 200, 0.03);">
                                <a class="cancel" style="background-color: #d31a1a" href="{% url 'google_token_revoke' project.id %}">Unlink Google Account</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}

    <form action="{% url 'dmp_upload' project.id %}" method="POST">
        {% csrf_token %}
        <table>
            <tr>
                <td style="padding-left: 0px; border-bottom: none"><input type="submit" onclick="show('loading')" value="Upload to Google Docs"></td>
                <td style="vertical-align: middle; border-bottom: none"><img id="loading" style="visibility: hidden" src="{% static 'loading.gif' %}"></td>
            </tr>
        </table>

        <h2>File will be uploaded to:</h2>
{#        <table>#}
{#            <tr>#}
{#                <td style="border-radius: 5px; border-bottom: none; background-color: #f1f1f1">DMP/{{ start_year }}/{{ project.title }}_draftDMP</td>#}
{#                <td style="border: none">#}
{#                    <a id="change-button-upload-path"  onclick="display('id_upload_path')">Change</a>#}
{#                </td>#}
{#            </tr>#}
{#        </table>#}
{#        <br>#}

        {{ form.non_field_errors }}
        {{ form.upload_path.errors }}
        {{ form.upload_path.error_messages }}
        {{ form.upload_path }}
        <p style="font-size: smaller; margin-left: 5px; color: #999999">Edit to change destination</p>
        <h2>Content:</h2>
        {{ form.draft_dmp.errors }}
        {{ form.draft_dmp.error_messages }}
        {{ form.draft_dmp }}

{#        {% for field in form %}#}
{#            {{ field }}#}
{#        {% endfor %}#}
    </form>

    <script>
        function show(obj){
            var loading_img = document.getElementById(obj)
    loading_img.style.visibility = 'visible'
    }

    function display(obj){
        document.getElementById(obj).classList.toggle("hidden")
    }

    function showDetails() {
        document.getElementById("myDropdown").classList.toggle("show")
    }
    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {

            var dropdowns = document.getElementsByClassName("google_user_dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }

    $('input').on('keyup',function() {
        var path = document.getElementById('id_upload_path').value
        if (path.indexOf('\\') > -1) {
            alert('Cannot use \\ in file path')
        }

    })
    </script>

{% endblock %}



 


